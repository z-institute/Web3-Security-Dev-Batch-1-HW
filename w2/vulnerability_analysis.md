# DaoToken

## Vulnerability Analysis

- 只要 transfer Dao Token 給其它人，再透過 delegate，即可取得可投票票數，然後再 transfer 給下一個，再透過 delegate，又取得可投票票數，一直循環，即可一直累積可投票票數，最後投票通過惡意的提案
- DaoToken contract 裡的 function \_delegate 有個 uint256 \_addrBalance = balanceOf(\_addr);
- balanceOf 是當下 msg.sender 擁有者持有 DaoToken 的數量，這是可以隨時 transfer 的，用 balanceOf 這個來做為授權代理投票數量，顯而易見的，就是會被操控
- 無論是 phishing 其它人的 balance 來灌票，或是聯合其它人來灌票，都是能輕易的操控任何惡意的提案

### Mitigation

- 我認為的解法，就是設計代理 delegate 能記錄某個 address 把多少數量的 Dao Token 所代表的票數，請某個 address 來代理，例如: mapping(uint32 => mapping(address => mapping(address => uint256))) public ProposalFromToDelegated;
- 如果投票時，一定要保證每個 Dao Token 持有者 BalanceOf 的數量和 delegated 數量相符，那可以再寫一個 function，去 loop 更新每個 From address 的 BalanceOf(daoToken) 去取代 ProposalFromToDelegated 代理的數量
